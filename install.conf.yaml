# Dotbot configuration script for idempotently installing managed dotfiles into system
# Reference: https://github.com/anishathalye/dotbot#configuration

# A space for command options that should be reused each time a certain kind of command is run.
- defaults:
    link:
      # Remove the old target if its a symlink
      relink: true
    # The following logic should be inverted, but there's a bug in the plugin code.
    # PR: https://github.com/wren/dotbot-brew/pull/1
    brewfile:
      stdout: false
      stdin: false
    brew:
      stdout: false

# ---
# Initialization procedure. Each item below is a step that executes in order.
# ---

# Remove dead symlinks (not recursive)
- clean: ['~']

# Install Homebrew if missing
- install-brew: true
- brew:
  - git

# Create symlinks
- link:
    # target : source

    # zsh config
    ~/.zprofile: zsh/zprofile
    ~/.zshrc: zsh/zshrc

    # git config
    ~/.gitconfig: git/gitconfig
    # TODO: fzf? main use case seems to be for better reverse search in history
    # TODO: nvm, automatic `nvm use` after changing directories (dotfiles). actually fnm looks like a good alternative.
    # TODO: rust + rustup + cargo
    # TODO: golang
    # TODO: maybe rbenv?

    # Create a "permalink" to the working copy of this repo, so other scripts can easily find the path
    ~/.dotfiles: ""

# Create empty directories
# - create:
#     - ~/downloads
#     - ~/.vim/undo-history

# Execute shell commands
- shell:
  # Checks out the commit stored in the submodule repo, into the working directory
  - [git submodule update --init --recursive, Installing submodules]
  -
    command: ~/.dotfiles/script/macos.sh
    description: Setting macOS defaults
    stdin: true
    stdout: true
    stderr: true

- brewfile:
  - brew/Brewfile

# TODO: install Xcode automatically?
# TODO: make the git credential manager thing get set up before i need to push any files
